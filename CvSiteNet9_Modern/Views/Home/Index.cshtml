@model CvSiteNet9_Modern.Models.Resume
@using System.Linq
@using System.Text.Json
@using System.Text.Json.Serialization
@{
    ViewData["Title"] = $"{Model.Name} | {Model.Title}";
    if (!string.IsNullOrWhiteSpace(Model.Summary))
    {
        ViewData["Description"] = Model.Summary;
    }

    var profileLinks = new[] { Model.Social.LinkedIn, Model.Social.Github, Model.Social.Website, Model.Social.X }
        .Where(s => !string.IsNullOrWhiteSpace(s))
        .ToArray();
    var knowAbout = (Model.Skills ?? new List<CvSiteNet9_Modern.Models.SkillSection>())
        .SelectMany(s => s.Items)
        .Where(i => !string.IsNullOrWhiteSpace(i))
        .Distinct()
        .ToArray();
    var jsonOptions = new JsonSerializerOptions
    {
        DefaultIgnoreCondition = JsonIgnoreCondition.WhenWritingNull
    };
    var jsonLd = JsonSerializer.Serialize(new
    {
        @context = "https://schema.org",
        @type = "Person",
        name = Model.Name,
        jobTitle = Model.Title,
        description = Model.Summary,
        email = string.IsNullOrWhiteSpace(Model.Email) ? null : $"mailto:{Model.Email}",
        telephone = string.IsNullOrWhiteSpace(Model.Phone) ? null : Model.Phone,
        url = profileLinks.FirstOrDefault(),
        sameAs = profileLinks.Any() ? profileLinks : null,
        address = string.IsNullOrWhiteSpace(Model.Location)
            ? null
            : new { @type = "PostalAddress", addressLocality = Model.Location, addressCountry = "TR" },
        knowsAbout = knowAbout.Any() ? knowAbout : null,
        worksFor = (Model.Experiences?.Any() ?? false)
            ? new { @type = "Organization", name = Model.Experiences.First().Company }
            : null
    }, jsonOptions);
}

<script type="application/ld+json">
    @Html.Raw(jsonLd)
</script>

<section class="row align-items-center g-4 hero reveal">
    <div class="col-lg-7">
        <span class="badge bg-opacity text-uppercase fw-semibold small">Merhaba, ben</span>
        <h1 class="display-5 fw-bold text-gradient mt-2">@Model.Name</h1>
        <p class="lead text-primary-emphasis">@Model.Title</p>
        @if (!string.IsNullOrWhiteSpace(Model.Summary))
        {
            <p class="fs-5 text-secondary">@Model.Summary</p>
        }

        @if (Model.Highlights?.Any() == true)
        {
            <ul class="hero-highlights list-unstyled mt-4">
                @foreach (var highlight in Model.Highlights)
                {
                    <li class="hero-highlight-item">
                        <span class="hero-highlight-icon" aria-hidden="true">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 12 4 4 10-10" /></svg>
                        </span>
                        <span>@highlight</span>
                    </li>
                }
            </ul>
        }

        <div class="mt-3 d-flex gap-2 flex-wrap">
            @if (!string.IsNullOrWhiteSpace(Model.Location)) { <span class="chip chip-secondary">@Model.Location</span> }
            @if (!string.IsNullOrWhiteSpace(Model.Email)) { <a class="chip chip-dark text-decoration-none" href="mailto:@Model.Email">@Model.Email</a> }
            @if (!string.IsNullOrWhiteSpace(Model.Phone)) { <span class="chip chip-info">@Model.Phone</span> }
        </div>

        <div class="mt-4 d-flex flex-wrap gap-2">
            <a class="btn btn-primary btn-lg hover-lift" asp-action="Resume">Özgeçmişi İncele</a>
            <a class="btn btn-soft-secondary btn-lg hover-lift" asp-controller="Contact" asp-action="Index">İletişim Kur</a>
            @if (!string.IsNullOrWhiteSpace(Model.Social.LinkedIn))
            {
                <a class="btn btn-soft-primary btn-lg hover-lift" target="_blank" rel="noopener" href="@Model.Social.LinkedIn">LinkedIn</a>
            }
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card glass shadow-sm hover-lift">
            <div class="card-body">
                <h5 class="card-title">Teknik Yetkinlikler</h5>
                @foreach (var skill in Model.Skills)
                {
                    <div class="skill-row">
                        <div class="fw-semibold">@skill.Heading</div>
                        <div class="text-muted">@string.Join(", ", skill.Items)</div>
                    </div>
                }
                @if (Model.Languages?.Any() == true)
                {
                    <div class="divider my-3"></div>
                    <h6 class="text-uppercase text-muted small mb-2">Yabancı Dil</h6>
                    <div class="d-flex flex-wrap gap-2">
                        @foreach (var language in Model.Languages)
                        {
                            <span class="language-chip">@language.Name <span class="text-muted">(@language.Level)</span></span>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</section>

@if (Model.Metrics?.Any() == true)
{
    <section class="metrics-grid reveal mt-5">
        @foreach (var metric in Model.Metrics)
        {
            <div class="metric-card">
                <div class="metric-value">@metric.Value</div>
                <div class="metric-label">@metric.Label</div>
            </div>
        }
    </section>
}

@if (Model.FocusAreas?.Any() == true)
{
    <section class="mt-5 reveal">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
            <h2 class="h4 mb-0">Stratejik Odak Alanları</h2>
            <a class="btn btn-soft-dark btn-sm hover-lift" asp-action="Resume">Tüm detayları gör</a>
        </div>
        <div class="focus-grid">
            @foreach (var focus in Model.FocusAreas)
            {
                <article class="focus-card">
                    <h3 class="focus-title">@focus.Title</h3>
                    <p class="text-secondary mb-0">@focus.Description</p>
                </article>
            }
        </div>
    </section>
}

@if (Model.Experiences?.Any() == true)
{
    <section class="mt-5 reveal">
        <h2 class="h4 mb-3">Profesyonel Deneyim</h2>
        <div class="timeline">
            @foreach (var exp in Model.Experiences)
            {
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-card card glass">
                        <div class="card-body">
                            <div class="d-flex justify-content-between flex-wrap gap-2 mb-2">
                                <div>
                                    <div class="fw-semibold">@exp.Role</div>
                                    <div class="text-muted small">@exp.Company • @exp.Location</div>
                                </div>
                                <div class="badge bg-opacity small">@exp.Start - @(string.IsNullOrWhiteSpace(exp.End) ? "Günümüz" : exp.End)</div>
                            </div>
                            <ul class="mb-0">
                                @foreach (var highlight in exp.Highlights)
                                {
                                    <li>@highlight</li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>
}

<section class="mt-5 reveal">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
        <h2 class="h4 mb-0">Öne Çıkan Projeler</h2>
        <a class="btn btn-soft-primary btn-sm hover-lift" asp-action="Projects">Tüm projeleri görüntüle</a>
    </div>
    <div class="grid-portfolio">
        @foreach (var p in Model.Projects.Take(3))
        {
            <article class="card glass h-100 hover-lift">
                <div class="card-body">
                    <h3 class="card-title">@p.Name</h3>
                    <p class="card-text text-secondary">@p.Description</p>
                    <div class="d-flex gap-2 flex-wrap">
                        @if (p.Tech != null) { foreach (var t in p.Tech) { <span class="chip">@t</span> } }
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0 d-flex gap-2">
                    @if (!string.IsNullOrWhiteSpace(p.Url)) { <a class="btn btn-outline-primary btn-sm" href="@p.Url" target="_blank" rel="noopener">Demo</a> }
                    @if (!string.IsNullOrWhiteSpace(p.Repo)) { <a class="btn btn-outline-dark btn-sm" href="@p.Repo" target="_blank" rel="noopener">Kod</a> }
                </div>
            </article>
        }
    </div>
</section>

@if (!string.IsNullOrWhiteSpace(Model.ReferenceNote))
{
    <section class="mt-5 reveal">
        <div class="callout glass">
            <div>
                <h3 class="h5 mb-2">Referanslar</h3>
                <p class="mb-0 text-secondary">@Model.ReferenceNote</p>
            </div>
            <a class="btn btn-primary hover-lift" asp-controller="Contact" asp-action="Index">Referans Talep Et</a>
        </div>
    </section>
}
